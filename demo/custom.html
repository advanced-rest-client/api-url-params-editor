<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
  <title>api-url-params-editor demo</title>
  <script src="../../webcomponentsjs/webcomponents-loader.js"></script>
  <link rel="import" href="../../iron-demo-helpers/demo-pages-shared-styles.html">
  <link rel="import" href="../../iron-demo-helpers/demo-snippet.html">
  <link rel="import" href="../../paper-button/paper-button.html">
  <link rel="import" href="../../api-view-model-transformer/api-view-model-transformer.html">
  <link rel="import" href="../api-url-params-editor.html">
  <custom-style>
    <style is="custom-style" include="demo-pages-shared-styles">
    :root {
      --arc-font-body1: {
        @apply --paper-font-body1;
      }
    }

    h1 {
      @apply --paper-font-headline;
    }

    h2 {
      @apply --paper-font-title;
    }

    h3 {
      @apply --paper-font-subhead;
    }

    output {
      white-space: pre-wrap;
      @apply --paper-font-code1;
      font-size: 16px;
    }
    </style>
  </custom-style>
</head>
<body>
  <header>
    <h1>API URL params editor<h1>
  </header>
  <dom-bind id="demo">
    <template is="dom-bind">
      <api-view-model-transformer></api-view-model-transformer>
      <div class="vertical-section-container" role="main">
        <api-url-params-editor on-query-value-changed="_queryValueChanged" allow-custom></api-url-params-editor>
      </div>
      <div class="vertical-section-container" role="region" aria-labelledby="outputTitle">
        <h2 id="outputTitle">Produced output</h2>
        <h3>Query parametrs</h3>
        <output>[[queryValueString]]</output>
        <h3>Events log</h3>
        <div>
          <paper-button raised on-tap="clearEventsLog">Clear log</paper-button><br/>
          <output>[[eventsLog]]</output>
        </div>
      </div>
    </template>
  </dom-bind>
  <script>
  (function(scope) {
    scope._queryValueChanged = function(e) {
      let queryValue = e.detail.value;
      let result;
      if (queryValue) {
        result = JSON.stringify(queryValue);
      } else {
        result = '';
      }
      scope.set('queryValueString', result);
    };
    scope._logEvent = function(type, name, value) {
      let log = '[' + new Date().toGMTString() + ']: ';
      log += type + ' model changed: ' + name + '=' + value + '\n';
      let scopelog = scope.eventsLog;
      if (!scopelog) {
        scopelog = '';
      }
      scopelog += log;
      scope.eventsLog = scopelog;
    };
    scope.clearEventsLog = function() {
      scope.eventsLog = '';
    };
    window.addEventListener('query-parameter-changed', (e) => {
      console.log('query-parameter-changed', e.detail.name, e.detail.value);
      scope._logEvent('Query', e.detail.name, e.detail.value);
    });
  })(document.getElementById('demo'));
  </script>
</body>
</html>
