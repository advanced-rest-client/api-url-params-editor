<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-if.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-validatable-behavior/iron-validatable-behavior.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../iron-form/iron-form.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../marked-element/marked-element.html">
<link rel="import" href="../api-property-form-item/api-property-form-item.html">
<link rel="import" href="../markdown-styles/markdown-styles.html">

<dom-module id="api-url-params-custom-input">
  <template strip-whitespace>
    <style include="markdown-styles">
    :host {
      display: block;
      @apply --api-url-params-custom-input;
    }

    .form-row {
      @apply --layout-horizontal;
      @apply --layout-center;
      @apply --api-request-parameters-editor-row;
    }

    .name-field,
    .value-field {
      @apply --layout-flex;
      @apply --layout-horizontal;
      @apply --layout-start;
    }

    .param-name,
    api-property-form-item {
      @apply --layout-flex;
    }

    api-property-form-item[is-array] {
      margin-top: 8px;
    }

    .narrow.form-row {
      display: block;
      @apply --api-request-parameters-editor-row-narrow;
    }

    .name-field {
      margin-right: 12px;
    }

    .narrow .name-field {
      margin-right: 0;
    }
    </style>
    <div class$="form-row [[_computeNarrowClass(narrow)]]">
      <div class="name-field">
        <paper-input value="{{name}}" label="Parameter name" class="param-name" type="text" required auto-validate></paper-input>
      </div>
      <div class="value-field">
        <api-property-form-item model="[[model]]" name="[[name]]" value="{{value}}" required$="[[required]]"></api-property-form-item>
      </div>
    </div>
  </template>
  <script>
  /**
   * Renders custom query parameter property input.
   *
   * Styling
   *
   * Custom property | Description | Default
   * ----------------|-------------|----------
   * `--api-url-params-custom-input` | Mixin applied to this element | `{}`
   * `--api-request-parameters-editor-row` | Mixin applied to custom parameter form row | `{}`
   * `--api-request-parameters-editor-row-narrow` | Mixin applied to custom parameter form row when narrow | `{}`
   *
   * You can also style inputs as defined in
   * [api-property-form-item](https://github.com/advanced-rest-client/api-property-form-item)
   * element documentation.
   *
   * @customElement
   * @polymer
   * @demo demo/custom.html Cutom parameters
   * @memberof ApiElements
   * @appliesMixin Polymer.IronValidatableBehavior
   */
  class ApiUrlParamsCustomInput extends
  Polymer.mixinBehaviors([Polymer.IronValidatableBehavior], Polymer.Element) {
    static get is() {
      return 'api-url-params-custom-input';
    }
    static get properties() {
      return {
        /**
         * View model to use to render the form.
         * See `api-url-params-editor` element for more information.
         */
        model: Array,
        /**
         * Name of this custom control
         */
        name: {
          type: String,
          notify: true
        },
        /**
         * Value of the control
         */
        value: {
          type: String,
          notify: true
        },
        /**
         * The form can display query or URI parameters. When anything change in the form
         * it will send a corresponding custom event (`query-parameter-changed` or
         * `uri-parameter-changed`). To make this happen set the value of this property to
         * either `query` or `uri`.
         */
        required: Boolean,
        /**
         * If set it renders a narrow layout
         */
        narrow: Boolean
      };
    }
    // Overidden from Polymer.IronValidatableBehavior. Will set the `invalid`
    // attribute automatically, which should be used for styling.
    _getValidity() {
      if (!this.required) {
        return true;
      }
      if (!this.name) {
        return false;
      }
      return !!this.value;
    }
    /**
     * Computes css class name for narrow layout
     *
     * @param {Boolean} narrow Value of the `narrow` property.
     * @return {String} Class definition.
     */
    _computeNarrowClass(narrow) {
      return narrow ? 'narrow' : '';
    }
  }

  window.customElements.define(ApiUrlParamsCustomInput.is, ApiUrlParamsCustomInput);
  </script>
</dom-module>
