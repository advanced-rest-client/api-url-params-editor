<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
    <title>api-url-params-editor test</title>

    <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../node_modules/@polymer/test-fixture/test-fixture.js"></script>
    <script src="../node_modules/mocha/mocha.js"></script>
    <script src="../node_modules/chai/chai.js"></script>
    <script src="../node_modules/wct-mocha/wct-mocha.js"></script>

  </head>
  <body>
    <test-fixture id="Basic">
      <template>
        <api-url-params-custom-input></api-url-params-custom-input>
      </template>
    </test-fixture>

    <test-fixture id="Required">
      <template>
        <api-url-params-custom-input required></api-url-params-custom-input>
      </template>
    </test-fixture>

    <test-fixture id="Narrow">
      <template>
        <api-url-params-custom-input narrow></api-url-params-custom-input>
      </template>
    </test-fixture>

    <script type="module">
    import '../api-url-params-custom-input.js';
    suite('api-url-params-custom-input', () => {
      suite('_computeNarrowClass()', () => {
        let element;
        test('Returns "narrow" class', () => {
          element = fixture('Basic');
          let result = element._computeNarrowClass(true);
          assert.equal(result, 'narrow');
        });

        test('Returns empty class', () => {
          element = fixture('Basic');
          let result = element._computeNarrowClass(false);
          assert.equal(result, '');
        });

        test('Narrow attribute adds narrow class', (done) => {
          element = fixture('Narrow');
          flush(() => {
            const node = element.shadowRoot.querySelector('.form-row');
            assert.isTrue(node.classList.contains('narrow'));
            done();
          });
        });
      });

      suite('Validation', () => {
        let element;
        test('Always valid when not required', (done) => {
          element = fixture('Basic');
          flush(() => {
            const result = element.validate();
            assert.isTrue(result);
            done();
          });
        });

        test('Invalid without the name', (done) => {
          element = fixture('Required');
          flush(() => {
            const result = element.validate();
            assert.isFalse(result);
            done();
          });
        });

        test('Invalid without the value', (done) => {
          element = fixture('Required');
          element.name = 'test';
          flush(() => {
            const result = element.validate();
            assert.isFalse(result);
            done();
          });
        });
      });
    });
    </script>
  </body>
</html>
